# ブログ生成フロー仕様

クライアントから「ブログを書いてほしい」と要望を受けたときに、`client_instruction_responder.py` や `blog_server.py` で LLM に投げるプロンプトの作り方をまとめました。概論は 500 文字前後、各セクション本文は 1,500 文字前後で生成することを前提にしています。

## 参照するデータ
- インデックス: `indexes/` 配下のテキストファイル — セクションのキーとなる文章に近いタイトルやサマリーを探します。
- 知識ベース: `indexes/mybrain/` 配下のテキストファイル — Rahab Punkaholic Girls/Johanne の世界観や読者像を補足します。

## 生成手順
1. **概論 (500 文字程度)**
   1. `indexes/` と `indexes/mybrain/` にあるテキストファイルの要点を読み、ブログ全体の背景と狙いを 500 文字前後の日本語で要約するように LLM に依頼します。
   2. 「索引用のテキストを横断し、読者像にフィットする導入にする」と明示すると、セクション本文とのつながりが良くなります。

2. **セクション本文 (各 1,500 文字程度)**
   1. セクション見出しやリード文をキーに `indexes/` 内のテキストを照合し、近い内容を詳細素材として抽出します。
   2. `indexes/mybrain/` にあるテキストから Johanne の嗜好・不安・期待に触れる記述を併用し、読者文脈を補強します。
   3. 上記 2 つの素材をひとつのプロンプトにまとめ、1,500 文字前後の本文生成を指示します。構成（主張→根拠→示唆→次節へのブリッジ）を指定すると安定します。

## プロンプト例
以下のテンプレートを `client_instruction_responder.py` や `blog_server.py` へ渡す `prompt` として利用できます。`{section_title}` と `{section_lead}` を適宜差し替えてください。

```text
あなたは日本語で執筆する編集ライターです。
- 概論はすでに用意済み。これから「{section_title}」セクション本文（約1,500文字）を書いてください。
- セクションの意図: {section_lead}
- 参考インデックス: indexes/ 配下のテキストから近い要素を要約として活用。
- 読者像と世界観: indexes/mybrain/ 配下のテキストにある Johanne の嗜好・不安・期待を踏まえる。
- 構成: 主張 → 根拠/事例 → 示唆 → 次節へのブリッジ。
- トーン: パンクな反骨と冷静な分析が同居する語り口。過度な煽りや専門用語の羅列は避ける。
```

## 運用メモ
- 概論と各セクションを別々に生成し、最終的に一つの HTML に結合します。`client_instruction_responder.py` には `--filename` でファイル名を指定できます。
- LLM への入力が長くなる場合は、`indexes/` 内の関連テキストのみを貼り付けるか、要点だけを引用してください。
